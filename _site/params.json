{"name":"Version Cake","tagline":"Version Cake is an unobtrusive way to version APIs in your Rails app","body":"![Version Cake](https://raw.github.com/alicial/versioncake/master/images/versioncake-logo450x100.png)\r\n\r\n[![Build Status](https://secure.travis-ci.org/bwillis/versioncake.png?branch=master)](http://travis-ci.org/bwillis/versioncake)\r\n[![Code Climate](https://codeclimate.com/github/bwillis/versioncake.png)](https://codeclimate.com/github/bwillis/versioncake)\r\n[![Coverage Status](https://coveralls.io/repos/bwillis/versioncake/badge.png?branch=master)](https://coveralls.io/r/bwillis/versioncake)\r\n[![Dependency Status](https://gemnasium.com/bwillis/versioncake.png)](https://gemnasium.com/bwillis/versioncake)\r\n[![Gem Version](https://badge.fury.io/rb/versioncake.png)](http://badge.fury.io/rb/versioncake)\r\n\r\nCo-authored by Ben Willis ([@bwillis](https://github.com/bwillis/)) and Jim Jones ([@aantix](https://github.com/aantix)).\r\n\r\nVersion Cake is an unobtrusive way to version APIs in your Rails app. \r\n\r\n- Easily version any view with their API version:\r\n\r\n```ruby\r\napp/views/posts/\r\n - index.xml.v1.builder\r\n - index.xml.v3.builder\r\n - index.json.v1.jbuilder\r\n - index.json.v4.jbuilder\r\n```\r\n- Gracefully degrade requests to the latest supported version\r\n- Clients can request API versions through different strategies\r\n- Dry your controller logic with exposed helpers\r\n\r\nCheck out https://github.com/bwillis/350-rest-api-versioning for a comparison of traditional versioning approaches and a versioncake implementation.\r\n\r\n## Install\r\n\r\n```\r\ngem install versioncake\r\n```\r\n\r\n### Requirements\r\n\r\n| Version | Rails 3.2 Support? | Rails 4 Support? | Rails 4.1 Support? |\r\n| ------- |:---------:| -------:| -------:|\r\n| 1.0     | Yes       | No      | No      |\r\n| 1.1     | Yes       | No      | No      |\r\n| 1.2     | Yes       | Yes     | No      |\r\n| 1.3     | Yes       | Yes     | No      |\r\n| 2.0     | Yes       | Yes     | Yes     |\r\n\r\n## Upgrade v1.0 -> v2.0\r\n\r\n### Filename changes\r\nThe major breaking change to require a bump to v2.0 was the order of the extensions. To avoid priority issues with the format (#14), the version number and the format have been swapped.\r\n\r\n`index.v1.json.jbuilder` -> `index.json.v1.jbuilder`\r\n\r\nTo make it easier to upgrade, run the following command to automatically rename these files:\r\n\r\n`verisoncake migrate` or `verisoncake migrate path/to/views`\r\n\r\n### Configuration changes\r\n\r\nThe configuration options for Version Cake have been namespaced and slightly renamed. The following is a mapping of the old names to the new names:\r\n\r\n| Old Name | New Name |\r\n| --------------------------------------- | -------------------------------------------- |\r\n| config.view_versions                    | config.versioncake.supported_version_numbers |\r\n| config.view_version_extraction_strategy | config.versioncake.extraction_strategy       |\r\n| config.view_version_string              | config.versioncake.version_key               |\r\n| config.default_version                  | config.versioncake.default_version           |\r\n\r\n## Example\r\n\r\nIn this simple example we will outline the code that is introduced to support a change in a version.\r\n\r\n### config/application.rb\r\n```ruby\r\nconfig.versioncake.supported_version_numbers = (1...4)\r\nconfig.versioncake.extraction_strategy       = :query_parameter # for simplicity\r\n```\r\n\r\nOften times with APIs, depending upon the version, different logic needs to be applied. With the following controller code, the initial value of @posts includes all Post entries.\r\nBut if the requested API version is three or greater, we're going to eagerly load the associated comments as well.  \r\n\r\nBeing able to control the logic based on the api version allow you to ensure forwards and backwards compatibility for future changes.\r\n\r\n### PostsController\r\n```ruby\r\nclass PostsController < ApplicationController\r\n  def index\r\n    # shared code for all versions\r\n    @posts = Post.scoped\r\n\r\n    # version 3 or greated supports embedding post comments\r\n    if derived_version >= 3\r\n      @posts = @posts.includes(:comments)\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nSee the view samples below. The basic top level posts are referenced in views/posts/index.json.v1.jbuilder.\r\nBut for views/posts/index.json.v4.jbuilder, we utilize the additional related comments.\r\n\r\n### Views\r\n\r\nNotice the version numbers are denoted by the \"v{version number}\" extension within the file name.\r\n\r\n#### views/posts/index.json.v1.jbuilder\r\n```ruby\r\njson.array!(@posts) do |json, post|\r\n    json.(post, :id, :title)\r\nend\r\n```\r\n\r\n#### views/posts/index.json.v4.jbuilder\r\n```ruby\r\njson.array!(@posts) do |json, post|\r\n    json.(post, :id, :title)\r\n    json.comments post.comments, :id, :text\r\nend\r\n```\r\n\r\n### Sample Output\r\n\r\nWhen a version is specified for which a view doesn't exist, the request degrades and renders the next lowest version number to ensure the API's backwards compatibility.  In the following case, since views/posts/index.json.v3.jbuilder doesn't exist, views/posts/index.json.v1.jbuilder is rendered instead.\r\n\r\n#### http://localhost:3000/posts.json?api_version=3 \r\n```javascript\r\n[\r\n  {\r\n    id: 1\r\n    title: \"Version Cake v0.1.0 Released!\"\r\n    name: \"Ben\"\r\n    updated_at: \"2012-09-17T16:23:45Z\"\r\n  },\r\n  {\r\n    id: 2\r\n    title: \"Version Cake v0.2.0 Released!\"\r\n    name: \"Jim\"\r\n    updated_at: \"2012-09-17T16:23:32Z\"\r\n  }\r\n]\r\n```\r\n\r\n\r\nFor a given request, if we specify the version number, and that version of the view exists, that version specific view version will be rendered.  In the below case, views/posts/index.json.v1.jbuilder is rendered.\r\n\r\n#### http://localhost:3000/posts.json?api_version=2 or http://localhost:3000/posts.json?api_version=1 \r\n```javascript\r\n[\r\n  {\r\n    id: 1\r\n    title: \"Version Cake v0.1.0 Released!\"\r\n    name: \"Ben\"\r\n    updated_at: \"2012-09-17T16:23:45Z\"\r\n  },\r\n  {\r\n    id: 2\r\n    title: \"Version Cake v0.2.0 Released!\"\r\n    name: \"Jim\"\r\n    updated_at: \"2012-09-17T16:23:32Z\"\r\n  }\r\n]\r\n```\r\n\r\n\r\nWhen no version is specified, the latest version of the view is rendered.  In this case, views/posts/index.json.v4.jbuilder.\r\n\r\n#### http://localhost:3000/posts.json\r\n```javascript\r\n[\r\n  {\r\n    id: 1\r\n    title: \"Version Cake v0.1.0 Released!\"\r\n    name: \"Ben\"\r\n    updated_at: \"2012-09-17T16:23:45Z\"\r\n    comments: [\r\n      {\r\n        id: 1\r\n        text: \"Woah interesting approach on versioning\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n     id: 2\r\n     title: \"Version Cake v0.2.0 Released!\"\r\n     name: \"Jim\"\r\n     updated_at: \"2012-09-17T16:23:32Z\"\r\n     comments: [\r\n      {\r\n        id: 4\r\n        text: \"These new features are greeeeat!\"\r\n      }\r\n    ]\r\n  }\r\n]\r\n```\r\n\r\n## How to use\r\n\r\n### Configuration\r\nThe configuration should be placed in your Rails projects `config/application.rb`. It is also suggested to enable different settings per environment, for example development and test can have extraction strategies that make it easier to develop or write test code.\r\n\r\n#### Supported Versions\r\nYou need to define the supported versions in your Rails application.rb file as `view_versions`. Use this config to set the range of supported API versions that can be served:\r\n\r\n```ruby\r\nconfig.versioncake.supported_version_numbers = [1,2,3,4,5] # or (1..5)\r\n```\r\n\r\n#### Extraction Strategy\r\n\r\nYou can also define the way to extract the version. The `view_version_extraction_strategy` allows you to set one of the default strategies or provide a proc to set your own. You can also pass it a prioritized array of the strategies.\r\n```ruby\r\nconfig.versioncake.extraction_strategy = :query_parameter # [:http_header, :http_accept_parameter]\r\n```\r\nThese are the available strategies:\r\n\r\nStrategy | Description | Example\r\n--- | --- | ---\r\n:query_parameter | version in the url query parameter, for testing or to override for special case | `http://localhost:3000/posts.json?api_version=1`  (This is the default.)\r\n:path_parameter | version in the url path parameter | `api/v:api_version/` \r\nrequest_parameter | version that is sent in the body of the request | Good for testing.\r\n:http_header | Api version HTTP header | `X-API-Version: 1`\r\n:http_accept_parameter | HTTP Accept header | `Accept: application/xml; version=1` [why do this?](http://blog.steveklabnik.com/posts/2011-07-03-nobody-understands-rest-or-http#i_want_my_api_to_be_versioned)\r\ncustom | takes the request object and must return an integer | lambda {&#124;request&#124; request.headers[\"HTTP_X_MY_VERSION\"].to_i }\r\n\r\n\r\n#### Default Version\r\n\r\nWhen no version is supplied by a client, the version rendered will be the latest version by default. If you want to override this to another version, set the following property:\r\n```ruby\r\nconfig.versioncake.default_version = 4\r\n```\r\n\r\n#### Version String\r\n\r\nThe extraction strategies use a default string key of `api_version`, but that can be changed:\r\n```ruby\r\nconfig.versioncake.version_key = \"special_version_parameter_name\"\r\n```\r\n\r\n### Version your views\r\n\r\nWhen a client makes a request to your controller the latest version of the view will be rendered. The latest version is determined by naming the template or partial with a version number that you configured to support.\r\n\r\n```\r\n- app/views/posts\r\n    - index.html.erb\r\n    - edit.html.erb\r\n    - show.html.erb\r\n    - show.json.jbuilder\r\n    - show.json.v1.jbuilder\r\n    - show.json.v2.jbuilder\r\n    - new.html.erb\r\n    - _form.html.erb\r\n```\r\n\r\nIf you start supporting a newer version, v3 for instance, you do not have to copy posts/show.v2 to posts/show.v3. By default, the request for v3 or higher will gracefully degrade to the view that is the newest, supported version, in this case posts/show.v2.\r\n\r\n### Controller\r\n\r\nYou don't need to do anything special in your controller, but if you find that you want to perform some tasks for a specific version you can use `requested_version` and `latest_version`. This may be updated in the [near future](https://github.com/bwillis/versioncake/issues/1).\r\n```ruby\r\ndef index\r\n  # shared code for all versions\r\n  @posts = Post.scoped\r\n\r\n  # version 3 or greated supports embedding post comments\r\n  if derived_version >= 3\r\n    @posts = @posts.includes(:comments)\r\n  end\r\nend\r\n```\r\n### Client requests\r\n\r\nWhen a client makes a request it will automatically receive the latest supported version of the view. The client can also request for a specific version by one of the strategies configured by ``view_version_extraction_strategy``.\r\n\r\n## How to test\r\n\r\nTesting can be painful but here are some easy ways to test different versions of your api using version cake.\r\n\r\n### Test configuration\r\n\r\nAllowing more extraction strategies during testing can be helpful when needing to override the version.\r\n```ruby\r\n# config/environments/test.rb\r\nconfig.versioncake.extraction_strategy = [:query_parameter, :request_parameter, :http_header, :http_accept_parameter]\r\n```\r\n\r\n### Testing a specific version\r\n\r\nOne way to test a specific version for would be to stub the requested version in the before block:\r\n```ruby\r\nbefore do\r\n  @controller.stubs(:requested_version).returns(3)\r\nend\r\n```\r\n\r\nYou can also test a specific version through a specific strategy such query_parameter or request_parameter strategies (configured in test environment) like so:\r\n```ruby\r\n# test/functional/renders_controller_test.rb#L47\r\ntest \"render version 1 of the partial based on the parameter _api_version\" do\r\n  get :index, \"api_version\" => \"1\"\r\n  assert_equal @response.body, \"index.html.v1.erb\"\r\nend\r\n```\r\n\r\n### Testing all supported versions\r\n\r\nYou can iterate over all of the supported version numbers by accessing the ```AppName::Application.config.versioncake.supported_version_numbers```.\r\n\r\n```ruby\r\nAppName::Application.config.versioncake.supported_version_numbers.each do |supported_version|\r\n  before do\r\n    @controller.stubs(:requested_version).returns(supported_version)\r\n  end\r\n  \r\n  test \"all versions render the correct template\" do\r\n    get :index\r\n    assert_equal @response.body, \"index.html.v1.erb\"\r\n  end\r\nend\r\n```\r\n\r\n# Thanks!\r\n\r\nThanks to all those who have helped make Version Cake really sweet:\r\n\r\n* [Manilla](https://github.com/manilla)\r\n* [Alicia](https://github.com/alicial)\r\n* [Rohit](https://github.com/rg)\r\n* Sevag\r\n* [Billy](https://github.com/bcatherall)\r\n* [Jérémie Meyer de Ville](https://github.com/jeremiemv)\r\n* [Michael Elfassy](https://github.com/elfassy)\r\n* [Kelley Reynolds](https://github.com/kreynolds)\r\n* [Washington L Braga Jr](https://github.com/huoxito)\r\n\r\n# Related Material\r\n\r\n## Usages\r\n\r\n- [Manilla](https://manilla.com) (original use case)\r\n- [Spree](http://spreecommerce.com/) and the [pull request](https://github.com/spree/spree/pull/2209)\r\n\r\n## Libraries\r\n\r\n- https://github.com/bploetz/versionist\r\n- https://github.com/filtersquad/rocket_pants\r\n- https://github.com/lyonrb/biceps\r\n\r\n## Discussions\r\n\r\n- [Peter Williams on versioning rest web services](http://barelyenough.org/blog/2008/05/versioning-rest-web-services/)\r\n- [Steve Klabnik on how to version in a resful way](http://blog.steveklabnik.com/posts/2011-07-03-nobody-understands-rest-or-http#i_want_my_api_to_be_versioned)\r\n- [Rails API project disucssion on versioning](https://github.com/rails-api/rails-api/issues/8)\r\n- [Railscast on versioning](http://railscasts.com/episodes/350-rest-api-versioning)\r\n- [Ruby5 on versioncake](http://ruby5.envylabs.com/episodes/310-episode-306-september-18th-2012/stories/2704-version-cake)\r\n- [Rails core discussion](https://groups.google.com/forum/#!msg/rubyonrails-core/odwmEYYIum0/9POep66BvoMJ)\r\n- [RubyWeekly](http://rubyweekly.com/archive/119.html)\r\n- [API building tools on Ruby Toolbox](https://www.ruby-toolbox.com/categories/API_Builders)\r\n\r\n# Questions?\r\n\r\nCreate a bug/enhancement/question on github or contact [aantix](https://github.com/aantix) or [bwillis](https://github.com/bwillis) through github.\r\n\r\n# License\r\n\r\nVersion Cake is released under the MIT license: www.opensource.org/licenses/MIT\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}